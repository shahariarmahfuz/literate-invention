{% extends layout %}

{% block content %}
<style>
    .profile-header {
        background: white; border: 1px solid #eef0f6; border-radius: 18px;
        padding: 30px; text-align: center; margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }
    .pro-pic {
        width: 120px; height: 120px; border-radius: 50%; object-fit: cover;
        border: 4px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 15px;
    }
    .badge-role {
        padding: 4px 12px; border-radius: 99px; font-size: 12px; font-weight: 700;
        text-transform: uppercase; letter-spacing: 0.5px;
    }
    .role-writer { background: #dcfce7; color: #166534; }
    .role-admin { background: #f1f5f9; color: #0f172a; }
    .role-user { background: #eff6ff; color: #1e40af; }

    /* Post Grid for Writers */
    .p-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .p-card {
        background: white; border: 1px solid #eef0f6; border-radius: 16px;
        overflow: hidden; transition: 0.2s;
    }
    .p-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
    .p-thumb { height: 160px; width: 100%; object-fit: cover; }
    .p-body { padding: 15px; }
    .p-title { font-weight: 700; font-size: 16px; margin-bottom: 6px; color: #0f172a; display: block; text-decoration: none;}
</style>

<div class="container" style="max-width: 900px;">

    <div class="profile-header">
        <img src="{{ url_for('static', filename='uploads/' + user.profile_pic) }}" class="pro-pic">

        <h2 class="fw-bold mb-1">{{ user.name or user.username }}</h2>
        <p class="text-muted mb-2">@{{ user.username }}</p>

        <span class="badge-role role-{{ user.role }}">
            {{ user.role }}
        </span>

        {% if user.bio %}
            <p class="mt-3 text-secondary" style="max-width: 600px; margin: 15px auto 0;">{{ user.bio }}</p>
        {% endif %}

        <div class="mt-3 text-muted small">
            {% if user.hobbies %}
                <span><i data-lucide="heart" style="width:14px"></i> {{ user.hobbies }}</span>
            {% endif %}
            <span class="mx-2">â€¢</span>
            <span>Joined: Dec 2025</span> </div>

        {% if current_user.is_authenticated and current_user.id == user.id %}
            <a href="{{ url_for('user_profile') }}" class="btn btn-sm btn-outline-primary mt-3">
                <i data-lucide="edit-3" style="width:14px"></i> Edit Profile
            </a>
        {% endif %}
    </div>

    {% if user.role == 'writer' %}
        <h4 class="mb-4 fw-bold"><i data-lucide="pen-tool" style="width:20px"></i> Published Articles ({{ posts|length }})</h4>

        {% if posts %}
            <div class="p-grid">
                {% for post in posts %}
                <div class="p-card">
                    {% if post.thumbnail %}
                        <img src="{{ url_for('static', filename='uploads/' + post.thumbnail) }}" class="p-thumb">
                    {% endif %}
                    <div class="p-body">
                        <small class="text-muted">{{ post.date_posted.strftime('%d %b, %Y') }}</small>
                        <a href="{{ url_for('post_detail', post_id=post.id) }}" class="p-title">{{ post.title }}</a>
                        <p class="text-muted small mb-0">{{ post.excerpt[:80] }}...</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center p-5 bg-white rounded border">
                <p class="text-muted">This writer hasn't published any posts yet.</p>
            </div>
        {% endif %}
    {% endif %}

</div>

<script>
    lucide.createIcons();
</script>
{% endblock %}