{% extends "base_admin.html" %}
{% block content %}
<style>
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  @media(max-width:1020px){ .wrap{max-width:520px} }

  .hero{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:18px;
    box-shadow:0 6px 18px rgba(16,24,40,.04);
    padding:14px;
  }
  .heroTop{
    display:flex;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    align-items:flex-start;
  }
  .title{
    font-size:14px;
    font-weight:900;
    letter-spacing:-0.2px;
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }
  .sub{
    margin-top:6px;
    font-size:12px;
    font-weight:300;
    color:var(--muted);
    line-height:1.55;
  }

  .chipRow{display:flex;gap:10px;flex-wrap:wrap}
  .chip{
    height:34px;
    padding:0 12px;
    border-radius:999px;
    border:1px solid var(--softBorder);
    background: rgba(255,255,255,0.35);
    color:var(--text);
    font-size:12px;
    font-weight:900;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:8px;
    user-select:none;
  }
  body[data-theme="dark"] .chip{background: rgba(255,255,255,0.06)}
  .chip:active{transform:scale(.98)}

  .filters{
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:space-between;
  }
  .searchInput{
    height:36px;
    width:min(360px, 100%);
    border-radius:999px;
    border:1px solid var(--softBorder);
    background: rgba(255,255,255,0.55);
    padding:0 12px;
    font-family:inherit;
    font-size:12px;
    color:var(--text);
    outline:none;
  }
  body[data-theme="dark"] .searchInput{
    background: rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.12);
  }

  .countPill{
    height:36px;
    padding:0 12px;
    border-radius:999px;
    border:1px solid var(--softBorder);
    background: rgba(255,255,255,0.35);
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-size:12px;
    font-weight:900;
    color:var(--text);
    white-space:nowrap;
    user-select:none;
  }
  body[data-theme="dark"] .countPill{background: rgba(255,255,255,0.06)}
  .countPill svg{width:16px;height:16px}

  .grid{
    margin-top:12px;
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap:12px;
  }
  @media(max-width:1020px){ .grid{grid-template-columns:1fr} }

  .reviewCard{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 6px 18px rgba(16,24,40,.04);
    min-width:0;
  }

  .thumb{
    width:100%;
    height:120px;
    background: rgba(15,23,42,0.06);
  }
  body[data-theme="dark"] .thumb{background: rgba(255,255,255,0.06)}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}

  .body{
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    min-width:0;
  }

  .rTitle{
    font-size:13px;
    font-weight:900;
    letter-spacing:-0.2px;
    line-height:1.35;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }

  .oneLine{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
    color:var(--muted);
    font-size:11px;
    font-weight:300;
  }
  .miniMeta{display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
  .miniMeta svg{width:14px;height:14px;stroke-width:1.7}

  .excerpt{
    font-size:12px;
    font-weight:300;
    color:var(--muted);
    line-height:1.55;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }

  .actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  .actBtn{
    height:34px;
    padding:0 12px;
    border-radius:999px;
    border:1px solid var(--softBorder);
    background: rgba(255,255,255,0.35);
    color:var(--text);
    font-size:12px;
    font-weight:900;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:8px;
    user-select:none;
    text-decoration:none;
  }
  body[data-theme="dark"] .actBtn{background: rgba(255,255,255,0.06)}
  .actBtn:active{transform:scale(.98)}
  .actBtn.primary{
    background:#0f172a;color:#fff;border:1px solid rgba(15,23,42,0.30);
  }
  body[data-theme="dark"] .actBtn.primary{
    background: rgba(255,255,255,0.14);
    border:1px solid rgba(255,255,255,0.16);
    color: var(--text);
  }
  .actBtn.danger{
    background: rgba(239,68,68,0.12);
    border:1px solid rgba(239,68,68,0.25);
  }
  body[data-theme="dark"] .actBtn.danger{
    background: rgba(239,68,68,0.16);
    border:1px solid rgba(239,68,68,0.26);
  }
</style>

<main class="wrap">
  <section class="hero">
    <div class="heroTop">
      <div style="min-width:0">
        <div class="title"><span data-lucide="scan"></span> Post Review</div>
        <div class="sub">Pending posts submitted by writers. Actions: View / Approve / Reject.</div>
      </div>

      <div class="chipRow">
        <button class="chip" type="button" onclick="location.reload()"><span data-lucide="refresh-ccw"></span> Refresh</button>
      </div>
    </div>

    <div class="filters">
      <div class="countPill" title="Total posts pending review">
        <span data-lucide="file-text"></span>
        <span id="totalCount">{{ posts|length }}</span>
        <span>items</span>
      </div>

      <input class="searchInput" id="searchInput" type="search" placeholder="Search title / writer / categoryâ€¦">
    </div>
  </section>

  {% if posts %}
  <section class="grid" id="reviewGrid">
    {% for post in posts %}
    <article class="reviewCard" data-search="{{ post.title }} {{ post.author.username }} {{ post.category }}">
      <div class="thumb">
        <img src="{{ url_for('static', filename='uploads/' + (post.thumbnail or 'default.jpg')) }}" alt="{{ post.title }}">
      </div>

      <div class="body">
        <div class="rTitle">{{ post.title }}</div>

        <div class="oneLine">
          <span class="miniMeta"><span data-lucide="user"></span><span>{{ post.author.username }}</span></span>
          <span class="miniMeta"><span data-lucide="calendar"></span><span>{{ post.date_posted.strftime('%b %d, %Y') }}</span></span>
          <span class="miniMeta"><span data-lucide="tag"></span><span>{{ post.category }}</span></span>
        </div>

        <div class="excerpt">{{ post.excerpt[:120] }}...</div>

        <div class="actions">
          <a class="actBtn" href="{{ url_for('post_detail', post_id=post.id) }}">
            <span data-lucide="external-link"></span> View Post
          </a>

          <a class="actBtn primary" href="{{ url_for('approve_post', id=post.id) }}">
            <span data-lucide="check-circle"></span> Approve
          </a>

          <a class="actBtn danger" href="{{ url_for('reject_post', id=post.id) }}">
            <span data-lucide="x-circle"></span> Reject
          </a>
        </div>
      </div>
    </article>
    {% endfor %}
  </section>
  {% else %}
    <div class="sub" style="margin-top:12px;">No pending posts right now.</div>
  {% endif %}
</main>

<script>
  if (window.lucide) lucide.createIcons();

  const searchInput = document.getElementById("searchInput");
  const totalCount = document.getElementById("totalCount");
  const cards = Array.from(document.querySelectorAll("#reviewGrid .reviewCard"));

  if (searchInput) {
    searchInput.addEventListener("input", () => {
      const q = (searchInput.value || "").toLowerCase().trim();
      let visible = 0;
      cards.forEach(card => {
        const hay = (card.dataset.search || "").toLowerCase();
        const show = !q || hay.includes(q);
        card.style.display = show ? "block" : "none";
        if (show) visible += 1;
      });
      if (totalCount) totalCount.textContent = visible;
    });
  }
</script>
{% endblock %}
