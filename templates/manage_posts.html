{% extends layout %}

{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<div id="manage-posts-ui">
<style>
    /* Scoped CSS */
    #manage-posts-ui {
        font-family: 'Outfit', sans-serif;
        --bg: #f1f5f9;
        --text: #0f172a;
        --muted: #64748b;
        --card: #ffffff;
        --border: #eef0f6;
        --soft: #f8fafc;
        --softBorder: #e2e8f0;
        --softHover: rgba(15,23,42,0.06);
    }
    body[data-theme="dark"] #manage-posts-ui {
        --bg: #0A0A0A;
        --text: #e5e7eb;
        --muted: #a1a1aa;
        --card: rgba(255,255,255,0.06);
        --border: rgba(255,255,255,0.10);
        --soft: rgba(255,255,255,0.06);
        --softBorder: rgba(255,255,255,0.12);
        --softHover: rgba(255,255,255,0.08);
    }

    #manage-posts-ui .wrap { max-width: 980px; margin: 0 auto; padding: 10px 0; }

    /* Top Bar */
    #manage-posts-ui .topBar {
        display: flex; align-items: flex-end; justify-content: space-between; gap: 10px; flex-wrap: wrap;
        margin: 6px 0 16px;
    }

    #manage-posts-ui .pageTitle {
        font-size: 15px; font-weight: 700; /* Bold (Not 900) */
        letter-spacing: -0.2px;
        display: flex; align-items: center; gap: 10px; color: var(--text);
    }

    #manage-posts-ui .pageSub {
        margin-top: 6px; font-size: 12px; font-weight: 300; /* Light */
        color: var(--muted); line-height: 1.55;
    }

    #manage-posts-ui .segWrap {
        display: flex; gap: 8px; flex-wrap: wrap;
    }

    #manage-posts-ui .segBtn {
        height: 34px; padding: 0 14px; border-radius: 999px;
        border: 1px solid var(--softBorder);
        background: rgba(255,255,255,0.35);
        color: var(--text);
        font-size: 12px; font-weight: 500; /* Medium */
        cursor: pointer; display: inline-flex; align-items: center; gap: 8px;
        user-select: none; transition: 0.1s;
    }
    body[data-theme="dark"] #manage-posts-ui .segBtn { background: rgba(255,255,255,0.06); }

    #manage-posts-ui .segBtn.active {
        background: #0f172a; color: #fff; border: 1px solid rgba(15,23,42,0.30); font-weight: 600;
    }
    body[data-theme="dark"] #manage-posts-ui .segBtn.active {
        background: rgba(255,255,255,0.14); border: 1px solid rgba(255,255,255,0.16); color: var(--text);
    }
    #manage-posts-ui .segBtn:active { transform: scale(.98); }

    /* Layout */
    #manage-posts-ui .layout {
        display: grid; grid-template-columns: 1.2fr .8fr; gap: 14px; align-items: start; margin-top: 10px;
    }
    @media(max-width: 900px) { #manage-posts-ui .layout { grid-template-columns: 1fr; } }

    #manage-posts-ui .panel {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 18px; box-shadow: 0 4px 12px rgba(16,24,40,.03);
        overflow: hidden;
    }

    #manage-posts-ui .panelInner { padding: 16px; }

    #manage-posts-ui .panelTitle {
        display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; margin-bottom: 12px;
    }
    #manage-posts-ui .panelTitleLeft {
        display: flex; align-items: center; gap: 10px;
        font-size: 13px; font-weight: 700; /* Bold */
        color: var(--text);
    }

    #manage-posts-ui .countPill {
        height: 24px; padding: 0 10px; border-radius: 999px;
        border: 1px solid var(--softBorder);
        background: rgba(255,255,255,0.35);
        font-size: 11px; font-weight: 600; /* Semi-Bold */
        color: var(--text);
        display: inline-flex; align-items: center; gap: 8px; user-select: none;
    }
    body[data-theme="dark"] #manage-posts-ui .countPill { background: rgba(255,255,255,0.06); }

    /* Post Cards */
    #manage-posts-ui .cardGrid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 14px;
    }
    @media(max-width: 520px) { #manage-posts-ui .cardGrid { grid-template-columns: 1fr; } }

    #manage-posts-ui .postCard {
        background: var(--card); border: 1px solid var(--border);
        border-radius: 18px; overflow: hidden;
        box-shadow: 0 4px 12px rgba(16,24,40,.03);
        min-width: 0; transition: transform 0.2s;
    }
    #manage-posts-ui .postCard:hover { transform: translateY(-2px); border-color: #cbd5e1; }

    #manage-posts-ui .thumb {
        width: 100%; height: 130px; background: rgba(15,23,42,0.06); position: relative;
    }
    body[data-theme="dark"] #manage-posts-ui .thumb { background: rgba(255,255,255,0.06); }
    #manage-posts-ui .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }

    /* Badge on Thumb */
    #manage-posts-ui .status-badge {
        position: absolute; top: 10px; right: 10px;
        padding: 4px 8px; border-radius: 6px; 
        font-size: 10px; font-weight: 700; /* Bold */
        text-transform: uppercase; letter-spacing: 0.5px;
        background: rgba(0,0,0,0.6); color: white; backdrop-filter: blur(4px);
    }
    #manage-posts-ui .st-active { background: rgba(34,197,94,0.9); }
    #manage-posts-ui .st-pending { background: rgba(245,158,11,0.9); }
    #manage-posts-ui .st-rejected { background: rgba(239,68,68,0.9); }

    #manage-posts-ui .body { padding: 14px; display: flex; flex-direction: column; gap: 8px; min-width: 0; }

    #manage-posts-ui .title {
        font-size: 14px; font-weight: 600; /* Semi-Bold (Not Black) */
        letter-spacing: -0.1px; line-height: 1.35;
        color: var(--text);
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    #manage-posts-ui .excerpt {
        font-size: 12px; font-weight: 300; /* Light */
        color: var(--muted); line-height: 1.55;
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }

    #manage-posts-ui .meta {
        display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between;
        color: var(--muted); font-size: 11px; font-weight: 300; /* Light */
    }
    #manage-posts-ui .meta span { display: inline-flex; align-items: center; gap: 6px; white-space: nowrap; }
    #manage-posts-ui .meta svg { width: 14px; height: 14px; stroke-width: 1.7; }

    /* Actions */
    #manage-posts-ui .actions {
        display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 4px; padding-top: 8px; border-top: 1px solid var(--border);
    }

    #manage-posts-ui .iconLink {
        border: none; background: transparent;
        color: var(--muted); display: inline-flex; align-items: center; gap: 6px;
        cursor: pointer; padding: 6px 8px; border-radius: 8px;
        font-family: inherit; font-size: 12px; font-weight: 500; /* Medium */
        user-select: none; text-decoration: none;
    }
    #manage-posts-ui .iconLink:hover { background: var(--softHover); color: var(--text); }
    #manage-posts-ui .iconLink:active { transform: scale(.98); }
    #manage-posts-ui .iconLink svg { width: 16px; height: 16px; stroke-width: 1.8; }
    #manage-posts-ui .iconLink.del:hover { color: #ef4444; background: rgba(239,68,68,0.1); }

    /* Right Panel (Deleted) */
    #manage-posts-ui .miniList { display: flex; flex-direction: column; gap: 10px; }
    #manage-posts-ui .miniCard {
        border: 1px solid var(--border); border-radius: 14px; padding: 12px;
        background: rgba(255,255,255,0.30);
    }
    body[data-theme="dark"] #manage-posts-ui .miniCard { background: rgba(255,255,255,0.06); }

    #manage-posts-ui .miniTitle {
        font-size: 12px; font-weight: 600; /* Semi-Bold */
        line-height: 1.35; color: var(--text);
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    #manage-posts-ui .miniMeta {
        margin-top: 6px; font-size: 11px; font-weight: 300; /* Light */
        color: var(--muted); display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
    }

    #manage-posts-ui .empty {
        padding: 14px; border-radius: 14px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.35);
        color: var(--muted); font-size: 12px; font-weight: 300; /* Light */
        line-height: 1.55;
    }
    body[data-theme="dark"] #manage-posts-ui .empty { background: rgba(255,255,255,0.06); }
</style>

<div class="wrap">
    <div class="topBar">
        <div>
            <div class="pageTitle"><span data-lucide="file-text"></span> My Posts</div>
            <div class="pageSub">Manage your articles. Filter by status or view all.</div>
        </div>

        <div class="segWrap">
            <button class="segBtn active" id="btnAll" onclick="filterPosts('all')">
                <span data-lucide="layers"></span> All
            </button>
            <button class="segBtn" id="btnPending" onclick="filterPosts('pending')">
                <span data-lucide="clock"></span> Pending
            </button>
        </div>
    </div>

    <div class="layout">
        <section class="panel">
            <div class="panelInner">
                <div class="panelTitle">
                    <div class="panelTitleLeft" id="gridTitle">
                        <span data-lucide="layers"></span> All Posts
                    </div>
                    <div class="countPill"><span data-lucide="hash"></span> {{ posts|length }}</div>
                </div>

                <div class="cardGrid" id="postGrid">
                    {% for post in posts %}
                    <article class="postCard post-item" data-status="{{ post.status }}">
                        <div class="thumb">
                            {% if post.thumbnail %}
                                <img src="{{ url_for('static', filename='uploads/' + post.thumbnail) }}" alt="thumb">
                            {% else %}
                                <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#999;font-weight:300;font-size:12px;">No Image</div>
                            {% endif %}

                            {% if post.status == 'active' %}
                                <span class="status-badge st-active">Published</span>
                            {% elif post.status == 'pending' %}
                                <span class="status-badge st-pending">Pending</span>
                            {% elif post.status == 'rejected' %}
                                <span class="status-badge st-rejected">Rejected</span>
                            {% else %}
                                <span class="status-badge">Draft</span>
                            {% endif %}
                        </div>

                        <div class="body">
                            <div class="title">{{ post.title }}</div>
                            <div class="excerpt">{{ post.excerpt[:70] }}...</div>

                            <div class="meta">
                                <div style="display:flex;gap:10px;">
                                    <span><span data-lucide="calendar"></span> {{ post.date_posted.strftime('%b %d') }}</span>
                                </div>
                                <span><span data-lucide="tag"></span> {{ post.category }}</span>
                            </div>

                            <div class="actions">
                                <a href="{{ url_for('post_detail', post_id=post.id) }}" class="iconLink">
                                    <span data-lucide="link"></span> View
                                </a>
                                <a href="{{ url_for('edit_post', id=post.id) }}" class="iconLink">
                                    <span data-lucide="square-pen"></span> Edit
                                </a>
                                <button class="iconLink del" onclick="openDeleteConfirm('{{ url_for('delete_post', id=post.id) }}')">
                                    <span data-lucide="trash-2"></span> Delete
                                </button>
                            </div>
                        </div>
                    </article>
                    {% else %}
                    <div class="empty" style="grid-column: 1 / -1;">
                        No posts found. Start creating!
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <aside class="panel">
            <div class="panelInner">
                <div class="panelTitle">
                    <div class="panelTitleLeft">
                        <span data-lucide="trash-2"></span> Deleted
                    </div>
                    <div class="countPill"><span data-lucide="hash"></span> 0</div>
                </div>

                <div class="miniList">
                    <div class="empty">
                        No deleted items.
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>
</div>

<script>
    lucide.createIcons();

    function filterPosts(type) {
        const allPosts = document.querySelectorAll('.post-item');
        const btnAll = document.getElementById('btnAll');
        const btnPending = document.getElementById('btnPending');
        const gridTitle = document.getElementById('gridTitle');

        if(type === 'all') {
            btnAll.classList.add('active');
            btnPending.classList.remove('active');
            gridTitle.innerHTML = '<span data-lucide="layers"></span> All Posts';
        } else {
            btnAll.classList.remove('active');
            btnPending.classList.add('active');
            gridTitle.innerHTML = '<span data-lucide="clock"></span> Pending Posts';
        }
        lucide.createIcons();

        allPosts.forEach(post => {
            if(type === 'all') {
                post.style.display = 'block';
            } else {
                if(post.getAttribute('data-status') === 'pending') {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            }
        });
    }
</script>

{% endblock %}